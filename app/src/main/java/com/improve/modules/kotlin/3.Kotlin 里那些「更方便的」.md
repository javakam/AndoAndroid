
#### 3.Kotlin é‡Œé‚£äº›ã€Œæ›´æ–¹ä¾¿çš„ã€

> **ç ä¸Šå¼€å­¦** ğŸ‘‰ <https://kaixue.io/kotlin-basic-3/> <br>
**è§†é¢‘åœ°å€** ğŸ‘‰ <https://www.bilibili.com/video/av65034710> <br>

##### æ„é€ å™¨
- ã€Œä¸»æ„é€ å™¨ primary constructorã€
```
class User constructor(var name: String) { ... }
```
> æ³¨:æ„é€ å™¨ä¸­ä¼ å…¥çš„å‚æ•°å³ä¸ºè¯¥ç±»çš„å±æ€§ï¼ˆpropertyï¼‰ã€‚<br>
å’ŒJavaä¸åŒçš„æ˜¯,Kotlinä¸­çš„æ™®é€šä»£ç å— init{} æ˜¯ç´§è·Ÿåœ¨ä¸»æ„é€ å™¨åé¢æ‰§è¡Œçš„ï¼Œ
è¿™æ˜¯å› ä¸ºä¸»æ„é€ å™¨æœ¬èº«æ²¡æœ‰ä»£ç ä½“ï¼Œinit ä»£ç å—å°±å……å½“äº†ä¸»æ„é€ å™¨ä»£ç ä½“çš„åŠŸèƒ½ã€‚<br>

> å½“ç±»ä¸­æœ‰ä¸»æ„é€ å™¨æ—¶å¼ºåˆ¶è¦æ±‚æ¬¡æ„é€ å™¨è°ƒç”¨ä¸»æ„é€ å™¨:
- å¿…é¡»æ€§ï¼šåˆ›å»ºç±»çš„å¯¹è±¡æ—¶ï¼Œä¸ç®¡ä½¿ç”¨å“ªä¸ªæ„é€ å™¨ï¼Œéƒ½éœ€è¦ä¸»æ„é€ å™¨çš„å‚ä¸
- ç¬¬ä¸€æ€§ï¼šåœ¨ç±»çš„åˆå§‹åŒ–è¿‡ç¨‹ä¸­ï¼Œé¦–å…ˆæ‰§è¡Œçš„å°±æ˜¯ä¸»æ„é€ å™¨
```
å½“ä¸€ä¸ªç±»ä¸­åŒæ—¶æœ‰ä¸»æ„é€ å™¨ä¸æ¬¡æ„é€ å™¨çš„æ—¶å€™ï¼Œéœ€è¦è¿™æ ·å†™ï¼š
ğŸï¸
class User constructor(var name: String) {
                                   // ğŸ‘‡  ğŸ‘‡ ç›´æ¥è°ƒç”¨ä¸»æ„é€ å™¨
    constructor(name: String, id: Int) : this(name) {
    }
                                                // ğŸ‘‡ é€šè¿‡ä¸Šä¸€ä¸ªæ¬¡æ„é€ å™¨ï¼Œé—´æ¥è°ƒç”¨ä¸»æ„é€ å™¨
    constructor(name: String, id: Int, age: Int) : this(name, id) {
    }
}
```
**æ‰§è¡Œé¡ºåº:   ä¸»æ„é€ å™¨  ->  init{...}  ->  æ¬¡æ„é€ å™¨**

- Tip : Kotlinä¸­çš„ " : " å¯ä»¥ç†è§£ä¸º"ä¾èµ–"çš„æ„æ€ã€‚

- constructor æ˜¯ä¸å¯ä»¥çœç•¥çš„ï¼Œä¾‹å¦‚åœ¨ä¸»æ„é€ å™¨ä¸Šä½¿ç”¨ã€Œå¯è§æ€§ä¿®é¥°ç¬¦ã€æˆ–è€…ã€Œæ³¨è§£ã€ï¼š
```
ğŸï¸
class User private constructor(name: String) {
//           ğŸ‘† ä¸»æ„é€ å™¨è¢«ä¿®é¥°ä¸ºç§æœ‰çš„ï¼Œå¤–éƒ¨å°±æ— æ³•è°ƒç”¨è¯¥æ„é€ å™¨
}
```


##### å‡½æ•°ç®€åŒ–
å½“å‡½æ•°åªæœ‰ä¸€è¡Œä»£ç æ—¶å¯ä»¥ç®€å†™:
```
fun go() {
    println("simple + $name")
}

fun go2() = println("simple + $name")
```

##### å‚æ•°é»˜è®¤å€¼ & å‘½åå‚æ•° & ä½ç½®å‚æ•°
```
ğŸï¸
                           ğŸ‘‡
fun speak(name: String = "world") = println("Hello " + name)
```
è°ƒç”¨:
```
speak("å°æ˜")
speak()  // ä½¿ç”¨äº†é»˜è®¤å€¼ "world"
```
ä½†æ˜¯å½“å‚æ•°è¿‡å¤šæ—¶,å¯ä»¥æŒ‡å®šå…·ä½“å‚æ•°èµ‹å€¼:
```
fun speak(name: String = "world",age: Int) = println("Hello " + name)

speak(age=18)
speak(age = 1, name = "") // é¡ºåºå¯ä»¥æ”¹å˜
```
å‘½åå‚æ•°ç›¸å¯¹çš„ä¸€ä¸ªæ¦‚å¿µè¢«ç§°ä¸ºã€Œä½ç½®å‚æ•°ã€ï¼Œä¹Ÿå°±æ˜¯æŒ‰ä½ç½®é¡ºåºè¿›è¡Œå‚æ•°å¡«å†™:
```
å½“ä¸€ä¸ªå‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œå¦‚æœæ··ç”¨ä½ç½®å‚æ•°ä¸å‘½åå‚æ•°ï¼Œé‚£ä¹ˆæ‰€æœ‰çš„ä½ç½®å‚æ•°éƒ½åº”è¯¥æ”¾åœ¨ç¬¬ä¸€ä¸ªå‘½åå‚æ•°ä¹‹å‰ï¼š

ğŸï¸
fun speak(name: String = "world", age: Int) {...}

speak(name = "wo", 27) // ğŸ‘ˆ IDE ä¼šæŠ¥é”™ï¼ŒMixing named and positioned arguments is not allowed
speak("wo", age = 27) // ğŸ‘ˆ è¿™æ˜¯æ­£ç¡®çš„å†™æ³•
```

##### æœ¬åœ°å‡½æ•°ï¼ˆåµŒå¥—å‡½æ•°ï¼‰
```
ğŸï¸
fun login(user: String, password: String, illegalStr: String) {
    fun validate(value: String) {
        if (value.isEmpty()) {
                                              ğŸ‘‡
            throw IllegalArgumentException(illegalStr)
        }
    }
    
    validate(user, illegalStr)
    validate(password, illegalStr)
}
```

##### å­—ç¬¦ä¸²

###### å­—ç¬¦ä¸²æ¨¡æ¿
```
val name = "world"
println("Hi " + name)        //æ‹¼æ¥å­—ç¬¦ä¸²
println("Hi ${name.length}") //ä½¿ç”¨è¡¨è¾¾å¼
```

raw string (åŸç”Ÿå­—ç¬¦ä¸²)
```
val text = 
"""
    Hi $name!
    My name is $myName.\n
"""
```
\n å¹¶ä¸ä¼šè¢«è½¬ä¹‰
trimMargin() å»ç©ºæ ¼

##### æ•°ç»„å’Œé›†åˆ

- filterï¼šå¯¹æ¯ä¸ªå…ƒç´ è¿›è¡Œè¿‡æ»¤æ“ä½œï¼Œå¦‚æœ lambda è¡¨è¾¾å¼ä¸­çš„æ¡ä»¶æˆç«‹åˆ™ç•™ä¸‹è¯¥å…ƒç´ ï¼Œå¦åˆ™å‰”é™¤ï¼Œæœ€ç»ˆç”Ÿæˆæ–°çš„é›†åˆ

```
ğŸï¸
// [1, 2, 3]
      â¬‡ï¸
//  {2, 3}
â€‹
//            ğŸ‘‡ æ³¨æ„ï¼Œè¿™é‡Œå˜æˆäº† List
val newList: List = intArray.filter { i ->
    i != 1 // ğŸ‘ˆ è¿‡æ»¤æ‰æ•°ç»„ä¸­ç­‰äº 1 çš„å…ƒç´ 
}
```
- mapï¼šéå†æ¯ä¸ªå…ƒç´ å¹¶æ‰§è¡Œç»™å®šè¡¨è¾¾å¼ï¼Œæœ€ç»ˆå½¢æˆæ–°çš„é›†åˆ

```
ğŸï¸
//  [1, 2, 3]
       â¬‡ï¸
//  {2, 3, 4}
â€‹
val newList: List = intArray.map { i ->
    i + 1 // ğŸ‘ˆ æ¯ä¸ªå…ƒç´ åŠ  1
}
```
- flatMapï¼šéå†æ¯ä¸ªå…ƒç´ ï¼Œå¹¶ä¸ºæ¯ä¸ªå…ƒç´ åˆ›å»ºæ–°çš„é›†åˆï¼Œæœ€ååˆå¹¶åˆ°ä¸€ä¸ªé›†åˆä¸­
```

ğŸï¸
//          [1, 2, 3]
               â¬‡ï¸
// {"2", "a" , "3", "a", "4", "a"}
â€‹
intArray.flatMap { i ->
    listOf("${i + 1}", "a") // ğŸ‘ˆ ç”Ÿæˆæ–°é›†åˆ
}
```
###### Range (åŒºé—´)
```
val range: IntRange = 0 until 1000    -> [0,1000)

ğŸï¸
val range = 0..1000
//     ğŸ‘‡ é»˜è®¤æ­¥é•¿ä¸º 1ï¼Œè¾“å‡ºï¼š0, 1, 2, 3, 4, 5, 6, 7....1000,
for (i in range) {
    print("$i, ")
}
//
for (i in range step 2) {
    print("$i, ")
}
//é€’å‡åŒºé—´ downTo ï¼Œä¸è¿‡é€’å‡æ²¡æœ‰åŠå¼€åŒºé—´çš„ç”¨æ³•:
for (i in 4 downTo 1) {
    print("$i, ")
}
//

```
###### åºåˆ— Sequence åˆè¢«ç§°ä¸ºã€Œæƒ°æ€§é›†åˆæ“ä½œã€
- æƒ°æ€§çš„æ¦‚å¿µé¦–å…ˆå°±æ˜¯è¯´åœ¨ã€ŒğŸ‘‡ã€æ ‡æ³¨ä¹‹å‰çš„ä»£ç è¿è¡Œæ—¶ä¸ä¼šç«‹å³æ‰§è¡Œï¼Œå®ƒåªæ˜¯å®šä¹‰äº†ä¸€ä¸ªæ‰§è¡Œæµç¨‹ï¼Œåªæœ‰ result è¢«ä½¿ç”¨åˆ°çš„æ—¶å€™æ‰ä¼šæ‰§
- æƒ°æ€§æŒ‡å½“å‡ºç°æ»¡è¶³æ¡ä»¶çš„ç¬¬ä¸€ä¸ªå…ƒç´ çš„æ—¶å€™ï¼ŒSequence å°±ä¸ä¼šæ‰§è¡Œåé¢çš„å…ƒç´ éå†äº†ï¼Œå³è·³è¿‡äº† 4 çš„éå†ã€‚å¦‚ä¸‹:
```
ğŸï¸
val sequence = sequenceOf(1, 2, 3, 4)
val result: List = sequence
    .map { i ->
        println("Map $i")
        i * 2 
    }
    .filter { i ->
        println("Filter $i")
        i % 3  == 0 
    }
ğŸ‘‡
println(result.first()) // ğŸ‘ˆ åªå–é›†åˆçš„ç¬¬ä¸€ä¸ªå…ƒç´ 
```
> Sequence è¿™ç§ç±»ä¼¼æ‡’åŠ è½½çš„å®ç°æœ‰ä¸‹é¢è¿™äº›ä¼˜ç‚¹ï¼š

ä¸€æ—¦æ»¡è¶³éå†é€€å‡ºçš„æ¡ä»¶ï¼Œå°±å¯ä»¥çœç•¥åç»­ä¸å¿…è¦çš„éå†è¿‡ç¨‹ã€‚
åƒ List è¿™ç§å®ç° Iterable æ¥å£çš„é›†åˆç±»ï¼Œæ¯è°ƒç”¨ä¸€æ¬¡å‡½æ•°å°±ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„ Iterableï¼Œä¸‹ä¸€ä¸ªå‡½æ•°å†åŸºäºæ–°çš„ Iterable æ‰§è¡Œï¼Œ
æ¯æ¬¡å‡½æ•°è°ƒç”¨äº§ç”Ÿçš„ä¸´æ—¶ Iterable ä¼šå¯¼è‡´é¢å¤–çš„å†…å­˜æ¶ˆè€—ï¼Œè€Œ Sequence åœ¨æ•´ä¸ªæµç¨‹ä¸­åªæœ‰ä¸€ä¸ªã€‚
å› æ­¤ï¼ŒSequence è¿™ç§æ•°æ®ç±»å‹å¯ä»¥åœ¨æ•°æ®é‡æ¯”è¾ƒå¤§æˆ–è€…æ•°æ®é‡æœªçŸ¥çš„æ—¶å€™ï¼Œä½œä¸ºæµå¼å¤„ç†çš„è§£å†³æ–¹æ¡ˆã€‚

##### æ¡ä»¶æ§åˆ¶

- if/else
```
if/else å…¶å®è¿˜å¯ä»¥æ˜¯ä¸€ä¸ªä»£ç å—ï¼Œä»£ç å—çš„æœ€åä¸€è¡Œä¼šä½œä¸ºç»“æœè¿”å›ï¼š

ğŸï¸
val max = if (a > b) {
    println("max:a")
    a // ğŸ‘ˆ è¿”å› a
} else {
    println("max:b")
    b // ğŸ‘ˆ è¿”å› b
}
```
- when (Java ä¸­çš„é»˜è®¤åˆ†æ”¯ä½¿ç”¨çš„æ˜¯ default å…³é”®å­—ï¼ŒKotlin ä¸­ä½¿ç”¨çš„æ˜¯ else)
```
ğŸï¸
ğŸ‘‡
when (x) {
   ğŸ‘‡
    1 -> { println("1") }
    2 -> { println("2") }
   ğŸ‘‡
    else -> { println("else") }
}
```
when ä½œä¸ºè¡¨è¾¾å¼ä½¿ç”¨:
```
val value: Int = when (x) {
    1 -> { x + 1 }
    2 -> { x * 2 }
    else -> { x + 5 }
}
```
when å¤šç§æƒ…å†µæ‰§è¡ŒåŒä¸€ä»½ä»£ç æ—¶,ç”¨é€—å·(,)éš”å¼€:
```
when (x) {
    ğŸ‘‡
    1, 2 -> print("x == 1 or x == 2")
    else -> print("else")
}
```
- â¤ when ç”¨è¡¨è¾¾å¼ä½œä¸ºåˆ†æ”¯çš„åˆ¤æ–­æ¡ä»¶

    * ä½¿ç”¨ in æ£€æµ‹æ˜¯å¦åœ¨ä¸€ä¸ªåŒºé—´æˆ–è€…é›†åˆä¸­ï¼š
    ```
    
    ğŸï¸
    when (x) {
       ğŸ‘‡
        in 1..10 -> print("x åœ¨åŒºé—´ 1..10 ä¸­")
       ğŸ‘‡
        in listOf(1,2) -> print("x åœ¨é›†åˆä¸­")
       ğŸ‘‡ // not in
        !in 10..20 -> print("x ä¸åœ¨åŒºé—´ 10..20 ä¸­")
        else -> print("ä¸åœ¨ä»»ä½•åŒºé—´ä¸Š")
    }
    ```
    * æˆ–è€…ä½¿ç”¨ is è¿›è¡Œç‰¹å®šç±»å‹çš„æ£€æµ‹ï¼š
    
    ```
    ğŸï¸
    val isString = when(x) {
        ğŸ‘‡
        is String -> true
        else -> false
    }
    ```
    
    * è¿˜å¯ä»¥çœç•¥ when åé¢çš„å‚æ•°ï¼Œæ¯ä¸€ä¸ªåˆ†æ”¯æ¡ä»¶éƒ½å¯ä»¥æ˜¯ä¸€ä¸ªå¸ƒå°”è¡¨è¾¾å¼ï¼š
    
    ```
    ğŸï¸
    when {
       ğŸ‘‡
        str1.contains("a") -> print("å­—ç¬¦ä¸² str1 åŒ…å« a")
       ğŸ‘‡
        str2.length == 3 -> print("å­—ç¬¦ä¸² str2 çš„é•¿åº¦ä¸º 3")
    }
    ```
    å½“åˆ†æ”¯çš„åˆ¤æ–­æ¡ä»¶ä¸ºè¡¨è¾¾å¼æ—¶ï¼Œå“ªä¸€ä¸ªæ¡ä»¶å…ˆä¸º true å°±æ‰§è¡Œå“ªä¸ªåˆ†æ”¯çš„ä»£ç å—ã€‚

##### for
Java
```
â˜•ï¸
int[] array = {1, 2, 3, 4};
for (int item : array) {
    ...
}
```
è€Œ Kotlin ä¸­ å¯¹æ•°ç»„çš„éå†æ˜¯è¿™ä¹ˆå†™çš„ï¼š
```

ğŸï¸
val array = intArrayOf(1, 2, 3, 4)
          ğŸ‘‡
for (item in array) {
    ...
}
```

##### try-catch
Kotlin å¼‚å¸¸å¤„ç†ä¸ Java çš„å¼‚å¸¸å¤„ç†åŸºæœ¬ç›¸åŒï¼Œä½†ä¹Ÿæœ‰å‡ ä¸ªä¸åŒç‚¹:

- æˆ‘ä»¬çŸ¥é“åœ¨ Java ä¸­ï¼Œè°ƒç”¨ä¸€ä¸ªæŠ›å‡ºå¼‚å¸¸çš„æ–¹æ³•æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å¯¹å¼‚å¸¸è¿›è¡Œå¤„ç†ï¼Œå¦åˆ™å°±ä¼šæŠ¥é”™ï¼š
```
â˜•ï¸
public class User{
    void sayHi() throws IOException {
    }
    
    void test() {
        sayHi();
        // ğŸ‘† IDE æŠ¥é”™ï¼ŒUnhandled exception: java.io.IOException
    }
}
```
ä½†åœ¨ Kotlin ä¸­ï¼Œè°ƒç”¨ä¸Šæ–¹ User ç±»çš„ sayHi æ–¹æ³•æ—¶ï¼š
```

ğŸï¸
val user = User()
user.sayHi() // ğŸ‘ˆ æ­£å¸¸è°ƒç”¨ï¼ŒIDE ä¸ä¼šæŠ¥é”™ï¼Œä½†è¿è¡Œæ—¶ä¼šå‡ºé”™
```
ä¸ºä»€ä¹ˆè¿™é‡Œä¸ä¼šæŠ¥é”™å‘¢ï¼Ÿå› ä¸º Kotlin ä¸­çš„å¼‚å¸¸æ˜¯ä¸ä¼šè¢«æ£€æŸ¥çš„ï¼Œåªæœ‰åœ¨è¿è¡Œæ—¶å¦‚æœ sayHi æŠ›å‡ºå¼‚å¸¸ï¼Œæ‰ä¼šå‡ºé”™ã€‚

Kotlin ä¸­ try-catch è¯­å¥ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œå…è®¸ä»£ç å—çš„æœ€åä¸€è¡Œä½œä¸ºè¿”å›å€¼ï¼š

```
ğŸï¸
           ğŸ‘‡       
val a: Int? = try { parseInt(input) } catch (e: NumberFormatException) { null }
```

##### ?. å’Œ ?:
```
val str: String? = "Hello"
var length: Int = str?.length
//                ğŸ‘† ï¼ŒIDE æŠ¥é”™ï¼ŒType mismatch. Required:Int. Found:Int?

                             ğŸ‘‡
val length: Int = str?.length ?: -1
```
- Elvis æ“ä½œç¬¦è¿˜æœ‰å¦å¤–ä¸€ç§å¸¸è§ç”¨æ³•ï¼Œå¦‚ä¸‹ï¼š
```
ğŸï¸
fun validate(user: User) {
    val id = user.id ?: return // ğŸ‘ˆ éªŒè¯ user.id æ˜¯å¦ä¸ºç©ºï¼Œä¸ºç©ºæ—¶ return 
}

// ç­‰åŒäº
fun validate(user: User) {
    if (user.id == null) {
        return
    }
    val id = user.id
}
```

##### == å’Œ ===
- Kotlin ä¸­ä¹Ÿæœ‰ä¸¤ç§ç›¸ç­‰æ¯”è¾ƒæ–¹å¼ï¼š

    1. == ï¼šå¯ä»¥å¯¹åŸºæœ¬æ•°æ®ç±»å‹ä»¥åŠ String ç­‰ç±»å‹è¿›è¡Œå†…å®¹æ¯”è¾ƒï¼Œç›¸å½“äº Java ä¸­çš„ equals ;
    2. === ï¼šå¯¹å¼•ç”¨çš„å†…å­˜åœ°å€è¿›è¡Œæ¯”è¾ƒï¼Œç›¸å½“äº Java ä¸­çš„ ==

